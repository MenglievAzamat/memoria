"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[391],{9734:function(e,t,a){a.d(t,{A:function(){return le}});var s=a(641),n=a(33),l=a.p+"img/book.a7af3d3b.png";const o={class:"leotaro relative w-full h-[47.5rem] text-center flex justify-end items-center mb-[3.75rem]"},i={key:0,class:"w-1/2 pr-[3rem] pl-[1.5rem] z-10"},c={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro']"},r={class:"text-[0.99975rem] font-['Leotaro']"},p={key:1,class:"helvetica w-full h-full px-[1.5rem] z-10 flex"},g={class:"w-1/2 h-full flex flex-col justify-center p-[4rem]"},h={class:"header h-[10%]"},u={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro'] text-left"},d={class:"h-[6%]"},x={key:0,class:"font-[Montserrat] text-black text-[1.66625rem] text-center mb-4 font-bold"},m={class:"body h-[79%]"},k=["src"],v=["innerHTML"],f={class:"footer h-[5%]"},b={class:"helvetica text-[1.4163125rem] text-black"},y={key:2,class:"helvetica w-full h-full px-[1.5rem] z-10 flex"},w={class:"w-1/2 h-full flex flex-col justify-center p-[4rem]"},L={class:"header h-[10%]"},P={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro'] text-right"},_={class:"h-[6%]"},E={key:0,class:"font-[Montserrat] text-black text-[1.66625rem] text-center mb-4 font-bold"},C={class:"body h-[79%]"},$=["src"],R=["innerHTML"],X={class:"footer h-[5%]"},A={class:"helvetica text-[1.4163125rem] text-black"},S={key:3,class:"helvetica w-full h-full px-[1.5rem] z-10 flex"},j={class:"w-1/2 h-full flex flex-col justify-center p-[4rem]"},Q={class:"header h-[10%]"},q={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro'] text-left"},I={class:"h-[6%]"},M={key:0,class:"font-[Montserrat] text-black text-[1.66625rem] text-center mb-4 font-bold"},T={class:"body h-[79%]"},U=["src"],F=["innerHTML"],H={class:"footer h-[5%]"},z={class:"helvetica text-[1.4163125rem] text-black"},D={class:"w-1/2 h-full flex flex-col justify-center p-[4rem]"},N={class:"header h-[10%]"},V={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro'] text-right"},B={class:"h-[6%]"},J={key:0,class:"font-[Montserrat] text-black text-[1.66625rem] text-center mb-4 font-bold"},O={class:"body h-[79%]"},W=["src"],Y=["innerHTML"],G={class:"footer h-[5%]"},K={class:"helvetica text-[1.4163125rem] text-black"};function Z(e,t,a,Z,ee,te){return(0,s.uX)(),(0,s.CE)("div",o,[a.payload.title?((0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("h1",c,(0,n.v_)(a.payload.title),1),(0,s.Lk)("h2",r,(0,n.v_)(a.payload.subtitle),1)])):a.payload.page&&a.payload.page%2!==0?((0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("div",g,[(0,s.Lk)("div",h,[(0,s.Lk)("p",u,(0,n.v_)(te.book.title),1)]),(0,s.Lk)("div",d,[a.payload?.title?((0,s.uX)(),(0,s.CE)("p",x,(0,n.v_)(a.payload?.title),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",m,[a.payload[0]?.image?((0,s.uX)(),(0,s.CE)("img",{key:0,class:"w-full h-full",src:a.payload?.image,alt:""},null,8,k)):(0,s.Q3)("",!0),(0,s.Lk)("p",{class:"helvetica text-[1.4163125rem] text-black text-justify",innerHTML:te.text(a.payload?.text)},null,8,v)]),(0,s.Lk)("div",f,[(0,s.Lk)("p",b,(0,n.v_)(a.payload?a.payload.page:""),1)])]),t[0]||(t[0]=(0,s.Lk)("div",{class:"w-1/2 h-full"},null,-1))])):a.payload.page&&a.payload.page%2===0?((0,s.uX)(),(0,s.CE)("div",y,[t[1]||(t[1]=(0,s.Lk)("div",{class:"w-1/2 h-full"},null,-1)),(0,s.Lk)("div",w,[(0,s.Lk)("div",L,[(0,s.Lk)("p",P,(0,n.v_)(te.book.subtitle),1)]),(0,s.Lk)("div",_,[a.payload?.title?((0,s.uX)(),(0,s.CE)("p",E,(0,n.v_)(a.payload?.title),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",C,[a.payload?.image?((0,s.uX)(),(0,s.CE)("img",{key:0,class:"w-full h-full",src:a.payload?.image,alt:""},null,8,$)):(0,s.Q3)("",!0),(0,s.Lk)("p",{class:"helvetica text-[1.4163125rem] text-black text-justify",innerHTML:te.text(a.payload?.text)},null,8,R)]),(0,s.Lk)("div",X,[(0,s.Lk)("p",A,(0,n.v_)(a.payload?a.payload.page:""),1)])])])):((0,s.uX)(),(0,s.CE)("div",S,[(0,s.Lk)("div",j,[(0,s.Lk)("div",Q,[(0,s.Lk)("p",q,(0,n.v_)(te.book.title),1)]),(0,s.Lk)("div",I,[a.payload[0]?.title?((0,s.uX)(),(0,s.CE)("p",M,(0,n.v_)(a.payload[0]?.title),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",T,[a.payload[0]?.image?((0,s.uX)(),(0,s.CE)("img",{key:0,class:"w-full h-full",src:a.payload[0]?.image,alt:""},null,8,U)):(0,s.Q3)("",!0),(0,s.Lk)("p",{class:"helvetica text-[1.4163125rem] text-black text-justify",innerHTML:te.text(a.payload[0]?.text)},null,8,F)]),(0,s.Lk)("div",H,[(0,s.Lk)("p",z,(0,n.v_)(a.payload[0]?a.payload[0].page:""),1)])]),(0,s.Lk)("div",D,[(0,s.Lk)("div",N,[(0,s.Lk)("p",V,(0,n.v_)(te.book.subtitle),1)]),(0,s.Lk)("div",B,[a.payload[1]?.title?((0,s.uX)(),(0,s.CE)("p",J,(0,n.v_)(a.payload[1]?.title),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",O,[a.payload[1]?.image?((0,s.uX)(),(0,s.CE)("img",{key:0,class:"w-full h-full",src:a.payload[1]?.image,alt:""},null,8,W)):(0,s.Q3)("",!0),(0,s.Lk)("p",{class:"helvetica text-[1.4163125rem] text-black text-justify",innerHTML:te.text(a.payload[1]?.text)},null,8,Y)]),(0,s.Lk)("div",G,[(0,s.Lk)("p",K,(0,n.v_)(a.payload[1]?a.payload[1].page:""),1)])])])),t[2]||(t[2]=(0,s.Lk)("img",{class:"absolute right-0 left-0 top-0 bottom-0 z-0",src:l,alt:"book.png"},null,-1))])}var ee=a(6506),te=a(9223),ae={name:"Preview",props:{payload:{type:Object},image:{type:File}},data:()=>({bookStore:(0,ee._)()}),computed:{book(){return this.bookStore.book}},methods:{text(e){let t=e?e.replaceAll("\n","<br>").replaceAll("    ","&nbsp;&nbsp;&nbsp;&nbsp;"):"";return(0,te.A)(t,{hyphens:!0})}}},se=a(6262);const ne=(0,se.A)(ae,[["render",Z],["__scopeId","data-v-385640e6"]]);var le=ne},3834:function(e,t,a){a.d(t,{A:function(){return h}});var s=a(641),n=a(33);const l={class:"flex justify-center items-center"},o={class:"w-[3.625rem] h-[2.0625rem] bg-[#D9D9D9] rounded flex justify-center items-center text-[1.125rem] mx-4"};function i(e,t,a,i,c,r){const p=(0,s.g2)("Icon");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",{class:"hover:scale-110 cursor-pointer",onClick:t[0]||(t[0]=t=>e.$emit("prevPage"))},[(0,s.bF)(p,{type:"arrow_left"})]),(0,s.Lk)("div",o,(0,n.v_)(a.page)+" / "+(0,n.v_)(a.total_pages),1),(0,s.Lk)("div",{class:"hover:scale-110 cursor-pointer",onClick:t[1]||(t[1]=t=>e.$emit("nextPage"))},[(0,s.bF)(p,{type:"arrow_right"})])])}var c=a(5196),r={name:"Pagination",components:{Icon:c.A},props:{page:{type:Number,required:!0},total_pages:{type:Number,required:!0}}},p=a(6262);const g=(0,p.A)(r,[["render",i],["__scopeId","data-v-12004ded"]]);var h=g},1104:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}});var s=a(641),n=a(33),l=a(3751);const o={key:1},i={key:0,class:"leading-none text-[1.5rem] mb-10"},c={key:1},r={class:"flex"},p={class:"flex"},g={class:"mb-4"},h=["disabled"],u={class:"flex justify-between mb-8"},d={class:"flex items-start"};function x(e,t,a,x,m,k){const v=(0,s.g2)("Loading"),f=(0,s.g2)("Icon"),b=(0,s.g2)("Pagination"),y=(0,s.g2)("Preview");return e.loading?((0,s.uX)(),(0,s.Wv)(v,{key:0})):((0,s.uX)(),(0,s.CE)("div",o,["admin"!==k.user.type?((0,s.uX)(),(0,s.CE)("p",i,(0,n.v_)(e.chapter?.question),1)):((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",r,[(0,s.bo)((0,s.Lk)("input",{class:"text-[1.5rem] mb-4 h-[2.9375rem] !rounded-r-none",type:"text","onUpdate:modelValue":t[0]||(t[0]=t=>e.chapter.title=t),placeholder:"Заголовок..."},null,512),[[l.Jo,e.chapter.title]])]),(0,s.Lk)("div",p,[(0,s.bo)((0,s.Lk)("input",{class:"text-[1.5rem] mb-10 h-[2.9375rem] !rounded-r-none",type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.chapter.question=t),placeholder:"Вопрос..."},null,512),[[l.Jo,e.chapter.question]]),(0,s.Lk)("button",{class:"!rounded-l-none",onClick:t[2]||(t[2]=(...e)=>k.saveQuestion&&k.saveQuestion(...e))},"Сохранить")])])),(0,s.Lk)("p",g,"Сраница: "+(0,n.v_)(e.page.page_number),1),(0,s.bo)((0,s.Lk)("textarea",{class:"mb-4",rows:"8",placeholder:"Введите текст...","onUpdate:modelValue":t[3]||(t[3]=t=>e.page.text=t),disabled:!!e.page.image},null,8,h),[[l.Jo,e.page.text]]),(0,s.Lk)("div",u,[(0,s.Lk)("div",d,[(0,s.Lk)("button",{class:"mr-2",onClick:t[4]||(t[4]=(...e)=>k.savePage&&k.savePage(...e))},"Сохранить"),(0,s.Lk)("button",{class:"mr-2",onClick:t[5]||(t[5]=(...e)=>k.startUpload&&k.startUpload(...e))},[(0,s.bF)(f,{class:"mr-1",type:"folder",color:"black"}),t[8]||(t[8]=(0,s.eW)(" Добавить фото "))]),(e.page.text||e.page.image)&&e.currentPage+1===e.totalPages?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[6]||(t[6]=(...e)=>k.addPage&&k.addPage(...e))}," + Новая страница ")):(0,s.Q3)("",!0),(0,s.Lk)("input",{id:"fileInput",type:"file",hidden:"",onInput:t[7]||(t[7]=(...e)=>k.makeInput&&k.makeInput(...e))},null,32)]),(0,s.Lk)("div",null,[(0,s.Lk)("p",null,(0,n.v_)(k.length)+" / 500",1)])]),(0,s.bF)(b,{page:e.currentPage+e.firstPage,total_pages:e.totalPages+e.firstPage-1,onNextPage:k.nextPage,onPrevPage:k.previousPage,class:"mb-[2.75rem]"},null,8,["page","total_pages","onNextPage","onPrevPage"]),(0,s.bF)(y,{payload:k.previewPayload},null,8,["payload"])]))}var m=a(5196),k=a(9734),v=a(6506),f=a(464),b=a(3834),y=a(3468),w=a(5800),L={name:"ChapterView",components:{Pagination:b.A,Loading:f.A,Preview:k.A,Icon:m.A},data:()=>({bookStore:(0,v._)(),userStore:(0,y.k)(),adminStore:(0,w.g)(),chapter:{},pages:[],prevPage:null,page:{id:0,text:null,image:null,question:null},pageText:null,currentPage:0,totalPages:0,firstPage:1,image:null,loading:!1}),computed:{user(){return this.userStore.user},length(){return this.page.text?this.page.text.length:0},previewPayload(){let e=[];return this.prevPage?e.push({text:this.prevPage.text,image:this.prevPage.image,page:this.prevPage.page_number,title:this.prevPage.page_number===this.firstPage?this.chapter.title:null}):this.page.page_number%2===0&&e.push({text:null,image:null,page:null}),e.push({text:this.page.text,image:this.page.image,page:this.page.page_number,title:this.page.page_number===this.firstPage?this.chapter.title:null}),this.pages[this.currentPage+1]&&e.push({text:this.pages[this.currentPage+1].text,image:this.pages[this.currentPage+1].image,page:this.pages[this.currentPage+1].page_number}),e}},methods:{startUpload(){document.querySelector("#fileInput").click()},makeInput(){const e=document.querySelector("#fileInput"),t=e.files;if(t&&t[0]){const e=new FileReader;e.onload=e=>{this.page.image=e.target.result},e.readAsDataURL(t[0]),this.image=t[0],this.$emit("input",t[0])}},async savePage(){this.loading=!0;let e=new FormData;e.append("text",this.page.text),e.append("image",this.image),await this.bookStore.savePage(this.page.id,e).then((()=>{this.page=this.bookStore.page})).finally((()=>{location.reload()}))},async addPage(){this.canUpdate()&&(this.loading=!0,await this.bookStore.addPage(this.chapter.id).then((async()=>{this.page.page_number%2!==0?this.setPrevPage():this.prevPage=null,await this.getChapter().then((()=>{this.page=this.bookStore.page,this.currentPage=this.pages.length-1}))})).catch((e=>{alert(e.response.data.message)})).finally((()=>{this.loading=!1})))},async getChapter(){this.loading=!0,this.prevPage=null,this.currentPage=0,await this.bookStore.getChapter(this.$route.params.id).then((()=>{this.chapter=this.bookStore.chapter,this.pages=this.chapter.pages,this.page=this.pages[0],this.firstPage=this.page.page_number,this.totalPages=this.pages.length})).finally((()=>{this.loading=!1}))},async saveQuestion(){let e=this.chapter.id,t={question:this.chapter.question,title:this.chapter.title};this.loading=!0,await this.adminStore.saveChapterQuestion(e,t)},setPrevPage(){this.prevPage=this.page},nextPage(){this.canUpdate()&&this.currentPage+1!==this.totalPages&&(this.page.page_number%2!==0?this.prevPage=this.page:this.prevPage=null,this.page=this.pages[++this.currentPage])},previousPage(){this.canUpdate()&&this.currentPage+1!==1&&(this.page.page_number%2!==0?this.prevPage=this.pages[this.currentPage-2]:this.prevPage=null,this.page=this.pages[--this.currentPage])},canUpdate(){return this.page.text===this.pageText||confirm("Вы сохранили страницу? Введённые изменения будут утеряны!")}},watch:{$route(e,t){this.getChapter()},"page.text"(){this.page.text&&(this.page.text=this.page.text.slice(0,500))},page(){this.pageText=this.page.text}},async mounted(){await this.getChapter().then((()=>{window.onbeforeunload=e=>{if(this.page.text!==this.pageText)return confirm("Все несохранённые изменения будут утеряны!")}}))}},P=a(6262);const _=(0,P.A)(L,[["render",x]]);var E=_},5800:function(e,t,a){a.d(t,{g:function(){return n}});var s=a(5615);const n=(0,s.nY)("admin",{state:()=>({books:!1}),actions:{setBooks(e){this.books=e},async fetchBooks(){await this.$axios.get("/admin/books").then((e=>{this.setBooks(e.data.books)}))},async saveUser(e){await this.$axios.post("/admin/user",e).then((e=>{alert(e.data.message),location.reload()}))},async saveChapter(e,t){await this.$axios.post(`/admin/book/${e}/chapter`,t).then((e=>{alert(e.data.message),location.reload()}))},async saveChapterQuestion(e,t){await this.$axios.put(`/admin/chapter/${e}/question`,t).then((e=>{alert(e.data.message),location.reload()}))}}})},9223:function(e,t,a){a.d(t,{A:function(){return k}});var s="[абвгдеёжзийклмнопрстуфхцчшщъыьэюя]",n="[аеёиоуыэюя]",l="[бвгджзклмнпрстфхцчшщ]",o="[йъь]",i="­",c="‑",r=" ",p="—",g="–",h="«",u="»",d={corto:"и|а|в|к|у|с|о|не|но|на|из|от|об|до|по|во|за|со",largo:"над|под|как"},x={hyphens:!1,digits:!1,digitsR:!1,header:!1,ndash:!1,quotes:!1},m={common:[[new RegExp("&nbsp;","gi"),r],[new RegExp(" (-|–|—) ","g"),"".concat(r).concat(p," ")],[new RegExp(" {2}","g")," "],[new RegExp("-(й|я|е) ","g"),"".concat(c,"$1 ")],[new RegExp("-(й|я|е) ","g"),"".concat(c,"$1").concat(r)],[new RegExp(" (".concat(d.corto,") "),"gi")," $1".concat(r)],[new RegExp("".concat(r,"(").concat(d.corto,") "),"gi"),"".concat(r,"$1").concat(r)],[new RegExp("^(".concat(d.corto,") "),"gi"),"$1".concat(r)]],digits:[[new RegExp(" (\\d+) ","g"),"".concat(r,"$1").concat(r)],[new RegExp("".concat(r,"(\\d+) "),"g"),"".concat(r,"$1").concat(r)]],digitsR:[[new RegExp(" (\\d+) ","g")," $1".concat(r)]],ndash:[[new RegExp("-","g"),"".concat(g)]],header:[[new RegExp(" (".concat(d.largo,") "),"gi")," $1".concat(r)]],hyphens:[[new RegExp("(".concat(o,")(").concat(s).concat(s,")"),"ig"),"$1".concat(i,"$2")],[new RegExp("(".concat(n,")(").concat(n).concat(s,")"),"ig"),"$1".concat(i,"$2")],[new RegExp("(".concat(n).concat(l,")(").concat(l).concat(n,")"),"ig"),"$1".concat(i,"$2")],[new RegExp("(".concat(l).concat(n,")(").concat(l).concat(n,")"),"ig"),"$1".concat(i,"$2")],[new RegExp("(".concat(n).concat(l,")(").concat(l).concat(l).concat(n,")"),"ig"),"$1".concat(i,"$2")],[new RegExp("(".concat(n).concat(l).concat(l,")(").concat(l).concat(l).concat(n,")"),"ig"),"$1".concat(i,"$2")]],quotes:[[new RegExp('\\="([^"]*)"',"gmi"),"='$1'"],[new RegExp('"('.concat(s,"|[0-9])"),"gmi"),"".concat(h,"$1")],[new RegExp('"',"gmi"),u],[new RegExp("\\='([^']*)'","gmi"),'="$1"']]};function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;if(null==e||"string"!==typeof e)return e;var a=Object.keys(m).reduce((function(e,a){return t[a]?e.concat(m[a]):e}),m.common);return a.reduce((function(e,t){return e.replace(t[0],t[1])}),e)}}}]);
//# sourceMappingURL=391.965d2f0b.js.map