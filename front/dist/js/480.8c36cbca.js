"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[480],{6636:function(t,e,a){a.d(e,{A:function(){return X}});var n=a(641),o=a(33),s=a.p+"img/book.a7af3d3b.png";const r={class:"leotaro relative w-full h-[47.5rem] text-center flex justify-end items-center mb-[3.75rem]"},c={key:0,class:"w-1/2 pr-[3rem] pl-[1.5rem] z-10"},i={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro']"},l={class:"text-[0.99975rem] font-['Leotaro']"},p={key:1,class:"helvetica w-full h-full px-[1.5rem] z-10 flex"},u={class:"w-1/2 h-full flex flex-col justify-center p-[4rem]"},d={class:"header h-[10%]"},g={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro'] text-left"},h={class:"body h-[85%]"},m={key:0,class:"font-[Montserrat] text-black text-[1.66625rem] text-center mb-4 font-bold"},f=["src"],x=["innerHTML"],k={class:"footer h-[5%]"},v={class:"helvetica text-[1.4163125rem] text-black"},y={class:"w-1/2 h-full flex flex-col justify-center p-[4rem]"},b={class:"header h-[10%]"},w={class:"text-black text-wrap text-[1.66625rem] font-['Leotaro'] text-right"},P={class:"body h-[85%]"},L={key:0,class:"font-[Montserrat] text-black text-[1.66625rem] text-center mb-4 font-bold"},C=["src"],E=["innerHTML"],$={class:"footer h-[5%]"},R={class:"helvetica text-[1.4163125rem] text-black"};function _(t,e,a,_,I,A){return(0,n.uX)(),(0,n.CE)("div",r,[a.payload.title?((0,n.uX)(),(0,n.CE)("div",c,[(0,n.Lk)("h1",i,(0,o.v_)(a.payload.title),1),(0,n.Lk)("h2",l,(0,o.v_)(a.payload.subtitle),1)])):((0,n.uX)(),(0,n.CE)("div",p,[(0,n.Lk)("div",u,[(0,n.Lk)("div",d,[(0,n.Lk)("p",g,(0,o.v_)(A.book.title),1)]),(0,n.Lk)("div",h,[a.payload[0]?.title?((0,n.uX)(),(0,n.CE)("p",m,(0,o.v_)(a.payload[0]?.title),1)):(0,n.Q3)("",!0),a.payload[0]?.image?((0,n.uX)(),(0,n.CE)("img",{key:1,class:"w-full h-full",src:a.payload[0]?.image,alt:""},null,8,f)):(0,n.Q3)("",!0),(0,n.Lk)("p",{class:"break-words hyphens-auto helvetica text-[1.4163125rem] text-black text-justify",innerHTML:A.text(a.payload[0]?.text)},null,8,x)]),(0,n.Lk)("div",k,[(0,n.Lk)("p",v,(0,o.v_)(a.payload[0]?a.payload[0].page:""),1)])]),(0,n.Lk)("div",y,[(0,n.Lk)("div",b,[(0,n.Lk)("p",w,(0,o.v_)(A.book.subtitle),1)]),(0,n.Lk)("div",P,[a.payload[1]?.title?((0,n.uX)(),(0,n.CE)("p",L,(0,o.v_)(a.payload[1]?.title),1)):(0,n.Q3)("",!0),a.payload[1]?.image?((0,n.uX)(),(0,n.CE)("img",{key:1,class:"w-full h-full",src:a.payload[1]?.image,alt:""},null,8,C)):(0,n.Q3)("",!0),(0,n.Lk)("p",{class:"break-words hyphens-auto helvetica text-[1.4163125rem] text-black text-justify",innerHTML:A.text(a.payload[1]?.text)},null,8,E)]),(0,n.Lk)("div",$,[(0,n.Lk)("p",R,(0,o.v_)(a.payload[1]?a.payload[1].page:""),1)])])])),e[0]||(e[0]=(0,n.Lk)("img",{class:"absolute right-0 left-0 top-0 bottom-0 z-0",src:s,alt:"book.png"},null,-1))])}var I=a(6506),A=a(9223),F={name:"Preview",props:{payload:{type:Object},image:{type:File}},data:()=>({bookStore:(0,I._)()}),computed:{book(){return this.bookStore.book}},methods:{text(t){let e=t?t.replaceAll("\n","<br>").replaceAll("    ","&nbsp;&nbsp;&nbsp;&nbsp;"):"";return(0,A.A)(e,{hyphens:!0})}}},q=a(6262);const S=(0,q.A)(F,[["render",_],["__scopeId","data-v-765ff516"]]);var X=S},94:function(t,e,a){a.d(e,{A:function(){return d}});var n=a(641),o=a(33);const s={class:"flex justify-center items-center"},r={class:"w-[5.625rem] h-[2.0625rem] bg-[#D9D9D9] rounded flex justify-center items-center text-[1.125rem] mx-4"};function c(t,e,a,c,i,l){const p=(0,n.g2)("Icon");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.Lk)("div",{class:"hover:scale-110 cursor-pointer",onClick:e[0]||(e[0]=e=>t.$emit("prevPage"))},[(0,n.bF)(p,{type:"arrow_left"})]),(0,n.Lk)("div",r,(0,o.v_)(a.page)+" / "+(0,o.v_)(a.total_pages),1),(0,n.Lk)("div",{class:"hover:scale-110 cursor-pointer",onClick:e[1]||(e[1]=e=>t.$emit("nextPage"))},[(0,n.bF)(p,{type:"arrow_right"})])])}var i=a(5196),l={name:"Pagination",components:{Icon:i.A},props:{page:{type:Number,required:!0},total_pages:{type:Number,required:!0}}},p=a(6262);const u=(0,p.A)(l,[["render",c],["__scopeId","data-v-26ca3a2b"]]);var d=u},8427:function(t,e,a){a.r(e),a.d(e,{default:function(){return E}});var n=a(641),o=a(33),s=a(3751);const r={key:1},c={key:0,class:"leading-none text-[1.5rem] mb-10"},i={key:1},l={class:"flex"},p={class:"flex"},u={class:"flex justify-between mb-8"},d={class:"flex items-start"},g=["disabled"];function h(t,e,a,h,m,f){const x=(0,n.g2)("Loading"),k=(0,n.g2)("Icon"),v=(0,n.g2)("Pagination"),y=(0,n.g2)("Preview");return t.loading?((0,n.uX)(),(0,n.Wv)(x,{key:0})):((0,n.uX)(),(0,n.CE)("div",r,["admin"!==f.user.type?((0,n.uX)(),(0,n.CE)("p",c,(0,o.v_)(t.chapter?.question),1)):((0,n.uX)(),(0,n.CE)("div",i,[(0,n.Lk)("div",l,[(0,n.bo)((0,n.Lk)("input",{class:"text-[1.5rem] mb-4 h-[2.9375rem] !rounded-r-none",type:"text","onUpdate:modelValue":e[0]||(e[0]=e=>t.chapter.title=e),placeholder:"Заголовок..."},null,512),[[s.Jo,t.chapter.title]])]),(0,n.Lk)("div",p,[(0,n.bo)((0,n.Lk)("input",{class:"text-[1.5rem] mb-10 h-[2.9375rem] !rounded-r-none",type:"text","onUpdate:modelValue":e[1]||(e[1]=e=>t.chapter.question=e),placeholder:"Вопрос..."},null,512),[[s.Jo,t.chapter.question]]),(0,n.Lk)("button",{class:"!rounded-l-none",onClick:e[2]||(e[2]=(...t)=>f.saveQuestion&&f.saveQuestion(...t))},"Сохранить")])])),e[11]||(e[11]=(0,n.Lk)("p",{class:"mb-4"},null,-1)),(0,n.bo)((0,n.Lk)("textarea",{class:"mb-4",rows:"8",placeholder:"Введите текст...","onUpdate:modelValue":e[3]||(e[3]=e=>t.chapter.text=e),onInput:e[4]||(e[4]=(...t)=>f.updateCursorPosition&&f.updateCursorPosition(...t)),onClick:e[5]||(e[5]=(...t)=>f.updateCursorPosition&&f.updateCursorPosition(...t)),onKeyup:e[6]||(e[6]=(...t)=>f.updateCursorPosition&&f.updateCursorPosition(...t))},null,544),[[s.Jo,t.chapter.text]]),(0,n.Lk)("div",u,[(0,n.Lk)("div",d,[(0,n.Lk)("button",{class:"mr-2",onClick:e[7]||(e[7]=(...t)=>f.saveChapter&&f.saveChapter(...t))},"Сохранить"),(0,n.Lk)("button",{class:"mr-2",onClick:e[8]||(e[8]=(...t)=>f.startUpload&&f.startUpload(...t)),disabled:null===t.cursorPosition},[(0,n.bF)(k,{class:"mr-1",type:"folder",color:"black"}),e[10]||(e[10]=(0,n.eW)(" Добавить фото "))],8,g),(0,n.Lk)("input",{id:"fileInput",type:"file",hidden:"",onInput:e[9]||(e[9]=(...t)=>f.makeInput&&f.makeInput(...t))},null,32)])]),(0,n.bF)(v,{page:t.currentPage+t.offset,total_pages:f.totalPages,onNextPage:f.nextPage,onPrevPage:f.previousPage,class:"mb-[2.75rem]"},null,8,["page","total_pages","onNextPage","onPrevPage"]),(0,n.bF)(y,{payload:f.previewPayload},null,8,["payload"])]))}var m=a(5196),f=a(6636),x=a(6506),k=a(464),v=a(94),y=a(3468),b=a(5800),w=a(4002),P={name:"ChapterView",components:{Pagination:v.A,Loading:k.A,Preview:f.A,Icon:m.A},data:()=>({bookStore:(0,x._)(),userStore:(0,y.k)(),adminStore:(0,b.g)(),chapter:{title:null,question:null,text:null},pages:[],pagesFormatted:[],currentPage:1,offset:0,cursorPosition:null,image:null,loading:!1}),computed:{totalPages(){return(this.pages.length>0?this.pages.length:1)+this.offset},user(){return this.userStore.user},previewPayload(){let t,e,a=this.currentPage+this.offset,n={title:null,text:null,page:null};return a%2===0?(t=this.pagesFormatted[this.currentPage-2]?this.pagesFormatted[this.currentPage-2]:n,e=this.pagesFormatted[this.currentPage-1]):(e=this.pagesFormatted[this.currentPage]?this.pagesFormatted[this.currentPage]:n,t=this.pagesFormatted[this.currentPage-1]),[t,e]}},methods:{startUpload(){document.querySelector("#fileInput").click()},makeInput(){const t=document.querySelector("#fileInput"),e=t.files;if(e&&e[0]){const t=new FileReader;t.readAsDataURL(e[0]),this.image=e[0],this.$emit("input",e[0])}},async getChapter(){this.loading=!0,await this.bookStore.getChapter(this.$route.params.id).then((t=>{this.chapter=t.chapter,this.offset=t.pc_last_page??0,this.currentPage=1})).finally((()=>{this.loading=!1}))},async saveQuestion(){let t=this.chapter.id,e={question:this.chapter.question,title:this.chapter.title};this.loading=!0,await this.adminStore.saveChapterQuestion(t,e)},async saveChapter(){this.loading=!0,await this.bookStore.saveChapter(this.chapter.id,this.chapter.text).finally((()=>{this.loading=!1}))},nextPage(){this.currentPage!==this.totalPages-this.offset&&this.currentPage++},previousPage(){1!==this.currentPage&&this.currentPage--},canUpdate(){return this.page.text===this.pageText||confirm("Вы сохранили страницу? Введённые изменения будут утеряны!")},updateCursorPosition(t){let e=t.target;this.cursorPosition=e.selectionStart}},watch:{async $route(t,e){await this.getChapter()},"chapter.text"(){this.pages=(0,w.H)(this.chapter.text)},pages(){this.pagesFormatted=(0,w.W)(this.pages,this.chapter.title,this.offset)},image(){console.log(this.image)}},async mounted(){await this.getChapter(),document.addEventListener("keydown",(t=>{(t.ctrlKey||t.metaKey)&&"s"===t.key&&(t.preventDefault(),this.saveChapter())}))}},L=a(6262);const C=(0,L.A)(P,[["render",h]]);var E=C},4002:function(t,e,a){function n(t){let e=[];if(t){let a=t.split(/\s/g),n="";for(let t in a){let o=0===e.length?500:534;n.length+a[t].length<=o?n+=a[t]+" ":(e.push(n.trim()),n=a[t]+" ")}0!==n.length&&e.push(n.trim())}return e}function o(t,e,a){let n=[];for(let o in t)n.push({title:0==o?e:null,text:t[o],page:parseInt(a)+parseInt(o)+1});return n}a.d(e,{H:function(){return n},W:function(){return o}})},5800:function(t,e,a){a.d(e,{g:function(){return o}});var n=a(5615);const o=(0,n.nY)("admin",{state:()=>({books:!1}),actions:{setBooks(t){this.books=t},async fetchBooks(){await this.$axios.get("/admin/books").then((t=>{this.setBooks(t.data.books)}))},async saveUser(t){await this.$axios.post("/admin/user",t).then((t=>{alert(t.data.message),location.reload()}))},async saveChapter(t,e){await this.$axios.post(`/admin/book/${t}/chapter`,e).then((t=>{alert(t.data.message),location.reload()}))},async saveChapterQuestion(t,e){await this.$axios.put(`/admin/chapter/${t}/question`,e).then((t=>{alert(t.data.message),location.reload()}))}}})},9223:function(t,e,a){a.d(e,{A:function(){return x}});var n="[абвгдеёжзийклмнопрстуфхцчшщъыьэюя]",o="[аеёиоуыэюя]",s="[бвгджзклмнпрстфхцчшщ]",r="[йъь]",c="­",i="‑",l=" ",p="—",u="–",d="«",g="»",h={corto:"и|а|в|к|у|с|о|не|но|на|из|от|об|до|по|во|за|со",largo:"над|под|как"},m={hyphens:!1,digits:!1,digitsR:!1,header:!1,ndash:!1,quotes:!1},f={common:[[new RegExp("&nbsp;","gi"),l],[new RegExp(" (-|–|—) ","g"),"".concat(l).concat(p," ")],[new RegExp(" {2}","g")," "],[new RegExp("-(й|я|е) ","g"),"".concat(i,"$1 ")],[new RegExp("-(й|я|е) ","g"),"".concat(i,"$1").concat(l)],[new RegExp(" (".concat(h.corto,") "),"gi")," $1".concat(l)],[new RegExp("".concat(l,"(").concat(h.corto,") "),"gi"),"".concat(l,"$1").concat(l)],[new RegExp("^(".concat(h.corto,") "),"gi"),"$1".concat(l)]],digits:[[new RegExp(" (\\d+) ","g"),"".concat(l,"$1").concat(l)],[new RegExp("".concat(l,"(\\d+) "),"g"),"".concat(l,"$1").concat(l)]],digitsR:[[new RegExp(" (\\d+) ","g")," $1".concat(l)]],ndash:[[new RegExp("-","g"),"".concat(u)]],header:[[new RegExp(" (".concat(h.largo,") "),"gi")," $1".concat(l)]],hyphens:[[new RegExp("(".concat(r,")(").concat(n).concat(n,")"),"ig"),"$1".concat(c,"$2")],[new RegExp("(".concat(o,")(").concat(o).concat(n,")"),"ig"),"$1".concat(c,"$2")],[new RegExp("(".concat(o).concat(s,")(").concat(s).concat(o,")"),"ig"),"$1".concat(c,"$2")],[new RegExp("(".concat(s).concat(o,")(").concat(s).concat(o,")"),"ig"),"$1".concat(c,"$2")],[new RegExp("(".concat(o).concat(s,")(").concat(s).concat(s).concat(o,")"),"ig"),"$1".concat(c,"$2")],[new RegExp("(".concat(o).concat(s).concat(s,")(").concat(s).concat(s).concat(o,")"),"ig"),"$1".concat(c,"$2")]],quotes:[[new RegExp('\\="([^"]*)"',"gmi"),"='$1'"],[new RegExp('"('.concat(n,"|[0-9])"),"gmi"),"".concat(d,"$1")],[new RegExp('"',"gmi"),g],[new RegExp("\\='([^']*)'","gmi"),'="$1"']]};function x(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m;if(null==t||"string"!==typeof t)return t;var a=Object.keys(f).reduce((function(t,a){return e[a]?t.concat(f[a]):t}),f.common);return a.reduce((function(t,e){return t.replace(e[0],e[1])}),t)}}}]);
//# sourceMappingURL=480.8c36cbca.js.map