{"version":3,"file":"js/326.f4ab06c3.js","mappings":"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","sources":["webpack://front/./src/components/Loading.vue","webpack://front/./src/components/Loading.vue?1ccf","webpack://front/./src/views/Book/ChapterView.vue","webpack://front/./src/views/Book/ChapterView.vue?2c6b"],"sourcesContent":["<template>\n    <div class=\"texture-bg absolute top-0 bottom-0 right-0 left-0 z-10\n                flex justify-center items-center\">\n        <div>\n            <img class=\"w-[18.75rem] h-[4.75rem] animate-bounce\" src=\"@/assets/img/logo.png\" alt=\"\">\n            <p v-if=\"text\">{{ text }}</p>\n        </div>\n    </div>\n</template>\n<script>\nexport default {\n    props: {\n        text: {\n            required: false\n        }\n    }\n}\n</script>","import { render } from \"./Loading.vue?vue&type=template&id=262e83e6\"\nimport script from \"./Loading.vue?vue&type=script&lang=js\"\nexport * from \"./Loading.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n    <Loading v-if=\"loading\"/>\n    <div v-else>\n        <p v-if=\"user.type !== 'admin'\" class=\"leading-none text-[1.5rem] mb-10\">{{ chapter?.question }}</p>\n        <div v-else>\n            <div class=\"flex\">\n                <input class=\"text-[1.5rem] mb-4 h-[2.9375rem] !rounded-r-none\" type=\"text\" v-model=\"chapter.title\"\n                       placeholder=\"Заголовок...\">\n            </div>\n            <div class=\"flex\">\n                <input class=\"text-[1.5rem] mb-10 h-[2.9375rem] !rounded-r-none\" type=\"text\" v-model=\"chapter.question\"\n                       placeholder=\"Вопрос...\">\n                <button class=\"!rounded-l-none\" @click=\"saveQuestion\">Сохранить</button>\n            </div>\n        </div>\n\n        <p class=\"mb-4\"></p>\n        <textarea\n            class=\"mb-4\"\n            rows=\"8\"\n            placeholder=\"Введите текст...\"\n            v-model=\"chapter.text\"\n            @input=\"updateCursorPosition\"\n            @click=\"updateCursorPosition\"\n            @keyup=\"updateCursorPosition\"\n        ></textarea>\n        <div class=\"flex justify-between mb-8\">\n            <div class=\"flex items-start\">\n                <button class=\"mr-2\" @click=\"saveChapter\">Сохранить</button>\n                <button class=\"mr-2\" @click=\"startUpload\" :disabled=\"cursorPosition === null\">\n                    <Icon class=\"mr-1\" type=\"folder\" color=\"black\"/>\n                    Добавить фото\n                </button>\n                <input id=\"fileInput\" type=\"file\" hidden @input=\"makeInput\">\n            </div>\n        </div>\n\n        <Pagination\n            :page=\"currentPage + offset\"\n            :total_pages=\"totalPages\"\n            @nextPage=\"nextPage\"\n            @prevPage=\"previousPage\"\n            class=\"mb-[2.75rem]\"\n        />\n\n        <Preview :payload=\"previewPayload\"/>\n    </div>\n</template>\n\n<script>\nimport Icon from \"@/components/Icon.vue\";\nimport Preview from \"@/components/Book/Preview.vue\";\nimport {useBookStore} from \"@/stores/book\";\nimport Loading from \"@/components/Loading.vue\";\nimport Pagination from \"@/components/Pagination.vue\";\nimport {useUserStore} from \"@/stores/user\";\nimport {useAdminStore} from \"@/stores/admin\";\nimport {chapterDivider, chapterDividerV2, pageFormatter} from \"@/plugins/helpers\";\n\nexport default {\n    name: \"ChapterView\",\n    components: {Pagination, Loading, Preview, Icon},\n\n    data: () => ({\n        bookStore: useBookStore(),\n        userStore: useUserStore(),\n        adminStore: useAdminStore(),\n\n        chapter: {\n            title: null,\n            question: null,\n            text: null,\n        },\n\n        pages: [],\n        pagesFormatted: [],\n        currentPage: 1,\n        offset: 0,\n        cursorPosition: null,\n\n        image: null,\n\n        loading: false,\n        chapterText: null,\n    }),\n\n    computed: {\n        totalPages() {\n            return (this.pages.length > 0 ? this.pages.length : 1) + this.offset\n        },\n\n        user() {\n            return this.userStore.user\n        },\n\n        previewPayload() {\n            let leftPage, rightPage\n            let pageNumber = this.currentPage + this.offset\n            let defaultPage = {\n                title: null,\n                text: null,\n                page: null,\n            }\n\n            if (pageNumber % 2 === 0) {\n                if (this.pagesFormatted[this.currentPage - 2]) {\n                    leftPage = this.pagesFormatted[this.currentPage - 2]\n                } else {\n                    leftPage = defaultPage\n                }\n\n                rightPage = this.pagesFormatted[this.currentPage - 1]\n            } else {\n                if (this.pagesFormatted[this.currentPage]) {\n                    rightPage = this.pagesFormatted[this.currentPage]\n                } else {\n                    rightPage = defaultPage\n                }\n\n\n                leftPage = this.pagesFormatted[this.currentPage - 1]\n            }\n\n            return [leftPage, rightPage]\n        },\n    },\n\n    methods: {\n        startUpload() {\n            document.querySelector('#fileInput').click()\n        },\n\n        async makeInput() {\n            alert('Каждая добавленная фотография займет целую страницу. ' +\n                'В текстовой строке появится \"ссылка\" на фото — она должна находиться в новой строке. ' +\n                'Чтобы удалить фотографию, просто удалите текст \"ссылки\".')\n\n            const input = document.querySelector('#fileInput')\n            const files = input.files\n\n            if (files && files[0]) {\n                const reader = new FileReader()\n\n                // reader.onload = (e) => {\n                //     this.image = e.target.result\n                // }\n\n                reader.readAsDataURL(files[0])\n                this.image = files[0]\n                this.$emit('input', files[0])\n\n                await this.bookStore.addImage(this.chapter.id, this.image).then(url => {\n                    let tmp\n\n                    if (this.cursorPosition !== 0) {\n                        tmp = [this.chapter.text.substring(0, this.cursorPosition), this.chapter.text.substring(this.cursorPosition)]\n                    } else {\n                        tmp = ['', '']\n                    }\n\n                    this.chapter.text = tmp[0] + `<img src=\"${url}\" alt=\"image\"/>` + tmp[1]\n                })\n            }\n        },\n\n        async getChapter() {\n            this.loading = true\n\n            await this.bookStore.getChapter(this.$route.params.id)\n                .then(response => {\n                    this.chapter = response.chapter\n                    this.offset = response.pc_last_page ?? 0\n                    this.currentPage = 1\n                    this.chapterText = response.chapter.text\n                })\n                .finally(() => {\n                    this.loading = false\n                })\n        },\n\n        async saveQuestion() {\n            let chapterId = this.chapter.id\n            let payload = {\n                question: this.chapter.question,\n                title: this.chapter.title\n            }\n\n            this.loading = true\n\n            await this.adminStore.saveChapterQuestion(chapterId, payload)\n        },\n\n        async saveChapter() {\n            this.loading = true\n\n            await this.bookStore.saveChapter(this.chapter.id, this.chapter.text)\n                .finally(() => {\n                    location.reload()\n                    this.loading = false\n                })\n        },\n\n        nextPage() {\n            if (this.currentPage !== this.totalPages - this.offset) {\n                this.currentPage++\n            }\n        },\n\n        previousPage() {\n            if (this.currentPage !== 1) {\n                this.currentPage--\n            }\n        },\n\n        canUpdate() {\n            if (this.chapter.text !== this.chapterText) {\n                return confirm('Вы сохранили страницу? Введённые изменения будут утеряны!')\n            }\n\n            return true;\n        },\n\n        updateCursorPosition(e) {\n            let target = e.target\n\n            this.cursorPosition = target.selectionStart\n        }\n    },\n\n    watch: {\n        async $route(to, from) {\n            await this.getChapter()\n        },\n\n        'chapter.text'() {\n            // this.pages = chapterDivider(this.chapter.text)\n            this.pages = chapterDividerV2(this.chapter.text)\n        },\n\n        pages() {\n            this.pagesFormatted = pageFormatter(this.pages, this.chapter.title, this.offset)\n        },\n\n        image() {\n            console.log(this.image)\n        },\n\n        cursorPosition() {\n            let symbols = 0\n            let page = null;\n\n            for (let i in this.pages) {\n                for (let j in this.pages[i]) {\n                    for (let k in this.pages[i][j]) {\n                        if (symbols > this.cursorPosition) {\n                            page = i\n                            break\n                        }\n\n                        symbols += this.pages[i][j][k].length + 1\n                    }\n\n                    if (page !== null) {\n                        break\n                    }\n                }\n\n                if (page !== null) {\n                    break\n                }\n            }\n\n            this.currentPage = +page + 1\n        }\n    },\n\n    async mounted() {\n        await this.getChapter()\n\n        document.addEventListener('keydown', event => {\n            if ((event.ctrlKey || event.metaKey) && event.key === 's') {\n                // Отменяем стандартное поведение (сохранение страницы)\n                event.preventDefault();\n\n                this.saveChapter()\n            }\n        })\n\n        // window.onbeforeunload = event => {\n        //     return this.canUpdate()\n        // };\n    },\n\n    beforeRouteUpdate(to, from, next) {\n        if (this.canUpdate()) {\n            next()\n        } else {\n            next(false)\n        }\n    },\n\n    beforeRouteLeave(to, from, next) {\n        if (this.canUpdate()) {\n            next()\n        } else {\n            next(false)\n        }\n    }\n}\n</script>","import { render } from \"./ChapterView.vue?vue&type=template&id=104e93d8\"\nimport script from \"./ChapterView.vue?vue&type=script&lang=js\"\nexport * from \"./ChapterView.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","src","alt","text","props","required","__exports__","render","loading","user","type","chapter","question","placeholder","title","saveQuestion","rows","updateCursorPosition","saveChapter","startUpload","disabled","cursorPosition","color","id","hidden","makeInput","page","currentPage","offset","total_pages","totalPages","nextPage","previousPage","payload","previewPayload","name","components","Pagination","Loading","Preview","Icon","data","bookStore","userStore","adminStore","pages","pagesFormatted","image","chapterText","computed","this","length","leftPage","rightPage","pageNumber","defaultPage","methods","document","querySelector","click","alert","input","files","reader","FileReader","readAsDataURL","$emit","addImage","then","url","tmp","substring","getChapter","$route","params","response","pc_last_page","finally","chapterId","saveChapterQuestion","location","reload","canUpdate","confirm","e","target","selectionStart","watch","to","from","console","log","symbols","i","j","k","mounted","addEventListener","event","ctrlKey","metaKey","key","preventDefault","beforeRouteUpdate","next","beforeRouteLeave"],"sourceRoot":""}